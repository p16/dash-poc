# Story 3.1: Google Gemini API Integration

## Status
Draft

## Story
**As a** developer,
**I want** to integrate Google Gemini 2.5 Pro API for LLM-powered analysis,
**so that** scraped plan data can be transformed into insights.

## Acceptance Criteria

1. Google Gemini API SDK installed and configured
2. `GEMINI_API_KEY` environment variable loaded and validated
3. API connection utility created with error handling
4. Rate limiting logic implemented to stay within free tier quotas
5. Basic test query to Gemini API succeeds
6. Response parsing utility handles JSON and text responses
7. API errors gracefully handled with fallback messaging

## Tasks / Subtasks

- [ ] Install Gemini API SDK (AC: 1)
  - [ ] Install `@google/generative-ai` package
  - [ ] Verify installation
- [ ] Configure environment variable (AC: 2)
  - [ ] Add `GEMINI_API_KEY` to `.env.local`
  - [ ] Update `.env.local.example`
  - [ ] Create validation function for API key
- [ ] Create API connection utility (AC: 3)
  - [ ] Create `src/lib/llm/gemini.ts`
  - [ ] Implement connection to Gemini API
  - [ ] Add error handling
  - [ ] Export utility functions
- [ ] Implement rate limiting (AC: 4)
  - [ ] Add rate limiting logic
  - [ ] Track API calls
  - [ ] Stay within free tier quotas
  - [ ] Add delays if needed
- [ ] Test basic query (AC: 5)
  - [ ] Create test script or test file
  - [ ] Send basic test query to Gemini API
  - [ ] Verify response received
- [ ] Implement response parsing (AC: 6)
  - [ ] Handle JSON responses
  - [ ] Handle text responses
  - [ ] Parse and structure responses
- [ ] Implement error handling (AC: 7)
  - [ ] Handle API errors gracefully
  - [ ] Provide fallback messaging
  - [ ] Log errors appropriately

## Dev Notes

### Source Tree
- LLM utilities: `src/lib/llm/gemini.ts`
- Environment variable: `GEMINI_API_KEY`
- Future prompt templates: `src/lib/llm/prompts/` (Story 3.2)

### Technical Stack
- Google Gemini 2.5 Pro API
- `@google/generative-ai` SDK
- Rate limiting for cost management

### Testing
- Test file location: `tests/unit/llm/gemini.test.ts` (to be created)
- Test framework: Jest
- Mock API responses for unit tests
- Manual integration test with real API (sparingly)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Story extracted from PRD | Architect |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_

