# Story 1.2: Neon PostgreSQL Database Connection

## Status
Draft

## Story
**As a** developer,
**I want** to establish connection to Neon PostgreSQL database,
**so that** scraped data can be stored and retrieved.

## Acceptance Criteria

1. New database created in existing Neon free tier account
2. `pg` (node-postgres) library installed for database connectivity
3. Database connection utility created and tested
4. Connection string (provided) configured via `DATABASE_URL` environment variable
5. Basic database connectivity test passes (can connect, run simple query)
6. Error handling for database connection failures implemented

## Tasks / Subtasks

- [ ] Create Neon database (AC: 1)
  - [ ] Access Neon account
  - [ ] Create new database for project
  - [ ] Note connection string
- [ ] Install node-postgres (AC: 2)
  - [ ] Install `pg` package
  - [ ] Install `@types/pg` for TypeScript types
- [ ] Create database connection utility (AC: 3)
  - [ ] Create `src/lib/db/connection.ts`
  - [ ] Implement connection function using `pg`
  - [ ] Configure connection pooling
  - [ ] Export connection utility
- [ ] Configure environment variable (AC: 4)
  - [ ] Add `DATABASE_URL` to `.env.local`
  - [ ] Update `.env.local.example` with placeholder
- [ ] Create connectivity test (AC: 5)
  - [ ] Create test script or test file
  - [ ] Test database connection
  - [ ] Test simple query execution (e.g., `SELECT NOW()`)
  - [ ] Verify test passes
- [ ] Implement error handling (AC: 6)
  - [ ] Add try-catch blocks in connection utility
  - [ ] Handle connection errors gracefully
  - [ ] Add meaningful error messages
  - [ ] Test error scenarios

## Dev Notes

### Source Tree
- Database utilities: `src/lib/db/connection.ts`
- Connection pooling should be configured for efficiency
- Environment variable: `DATABASE_URL` (PostgreSQL connection string from Neon)

### Technical Stack
- PostgreSQL (Neon serverless)
- `pg` (node-postgres) library
- Connection pooling for efficiency

### Testing
- Test file location: `tests/unit/db/connection.test.ts` (to be created)
- Test framework: Jest
- Test connection and basic query execution
- Test error handling scenarios

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Story extracted from PRD | Architect |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_

