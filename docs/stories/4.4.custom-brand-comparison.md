# Story 4.4: Custom Brand Comparison Tool

## Status
Draft

## Story
**As a** user,
**I want** to select two brands and trigger custom comparison analysis,
**so that** I can explore specific competitive matchups on demand.

## Acceptance Criteria

1. Form with two dropdowns to select Brand A and Brand B
2. Dropdowns populated with available telco brands from scraped data
3. "Compare" button triggers custom analysis API call
4. Loading indicator while analysis generates
5. Results displayed in analysis results view format
6. Error handling for failed analysis requests
7. Form validation prevents selecting same brand twice

## Tasks / Subtasks

- [ ] Create comparison form component (AC: 1)
  - [ ] Create `src/components/dashboard/CustomComparison.tsx`
  - [ ] Add two dropdown selects for Brand A and Brand B
  - [ ] Add "Compare" button
  - [ ] Style with Tailwind CSS
- [ ] Populate brand dropdowns (AC: 2)
  - [ ] Fetch available brands from database
  - [ ] Query distinct sources from plans table
  - [ ] Populate dropdowns with brand list
- [ ] Implement comparison trigger (AC: 3)
  - [ ] Call `/api/analysis/custom` endpoint
  - [ ] Pass brandA and brandB in request body
  - [ ] Handle API call
- [ ] Add loading indicator (AC: 4)
  - [ ] Show loading state during analysis
  - [ ] Disable form during loading
  - [ ] Display appropriate loading message
- [ ] Display results (AC: 5)
  - [ ] Use AnalysisResults component from Story 4.3
  - [ ] Pass custom analysis data to component
  - [ ] Display results after analysis completes
- [ ] Implement error handling (AC: 6)
  - [ ] Catch API errors
  - [ ] Display error messages to user
  - [ ] Handle timeout errors
- [ ] Add form validation (AC: 7)
  - [ ] Prevent selecting same brand twice
  - [ ] Show validation error if same brand selected
  - [ ] Disable compare button if invalid

## Dev Notes

### Source Tree
- Custom comparison component: `src/components/dashboard/CustomComparison.tsx`
- Analysis results component: `src/components/analysis/AnalysisResults.tsx` (from Story 4.3)
- API endpoint: `src/app/api/analysis/custom/route.ts` (from Story 3.4)
- Database queries: `src/lib/db/queries.ts` (to be created)

### Technical Stack
- React Client Component for form interactivity
- Next.js API routes for analysis trigger
- Tailwind CSS for styling

### Testing
- Test file location: `tests/integration/components/dashboard/CustomComparison.test.tsx` (to be created)
- Test framework: Jest + React Testing Library
- Test form validation, API calls, error handling

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Story extracted from PRD | Architect |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_

