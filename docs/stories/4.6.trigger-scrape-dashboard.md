# Story 4.6: Trigger Scrape from Dashboard

## Status
Draft

## Story
**As a** user,
**I want** to manually trigger scraping from the dashboard,
**so that** I can refresh plan data on demand.

## Acceptance Criteria

1. "Trigger Scrape" button visible on dashboard home
2. Button triggers Next.js API endpoint that executes scraping command
3. Loading indicator shows scraping in progress
4. Progress updates (if possible) or estimated completion time shown
5. Success message displays when scraping completes
6. Dashboard data refreshes to show newly scraped plans
7. Error handling for scraping failures with descriptive messages
8. Button disabled while scraping is running (prevent duplicate runs)

## Tasks / Subtasks

- [ ] Add trigger scrape button (AC: 1)
  - [ ] Add button to dashboard home page
  - [ ] Style with Tailwind CSS
  - [ ] Position appropriately
- [ ] Create scrape API endpoint (AC: 2)
  - [ ] Create `src/app/api/scrape/route.ts`
  - [ ] Import scraping script
  - [ ] Execute scraping command
  - [ ] Return response
- [ ] Implement loading indicator (AC: 3)
  - [ ] Show loading state when button clicked
  - [ ] Display loading message
  - [ ] Disable button during scraping
- [ ] Add progress updates (AC: 4)
  - [ ] If possible, stream progress updates
  - [ ] Or show estimated completion time
  - [ ] Update UI with progress
- [ ] Show success message (AC: 5)
  - [ ] Display success message when scraping completes
  - [ ] Show scrape results summary
  - [ ] Clear message after timeout
- [ ] Refresh dashboard data (AC: 6)
  - [ ] Refresh plan data after scrape completes
  - [ ] Update scrape status indicator
  - [ ] Reload analysis if needed
- [ ] Implement error handling (AC: 7)
  - [ ] Catch scraping errors
  - [ ] Display descriptive error messages
  - [ ] Log errors appropriately
- [ ] Prevent duplicate runs (AC: 8)
  - [ ] Disable button while scraping
  - [ ] Track scraping state
  - [ ] Re-enable after completion or error

## Dev Notes

### Source Tree
- Scrape API endpoint: `src/app/api/scrape/route.ts`
- Scraping script: `src/scripts/scrape.ts` (from Story 2.4)
- Dashboard page: `src/app/dashboard/page.tsx` (from Story 4.2)

### Technical Stack
- Next.js API routes for scraping trigger
- Scraping script execution
- Client-side state management for UI updates

### Testing
- Test file location: `tests/integration/api/scrape.test.ts` (to be created)
- Test framework: Jest
- Test API endpoint, error handling, button state

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Story extracted from PRD | Architect |

## Dev Agent Record

### Agent Model Used
_To be populated by Dev Agent_

### Debug Log References
_To be populated by Dev Agent_

### Completion Notes List
_To be populated by Dev Agent_

### File List
_To be populated by Dev Agent_

## QA Results
_To be populated by QA Agent_

